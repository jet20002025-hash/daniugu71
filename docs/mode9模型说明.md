# mode9 模型说明（当前主模型）

mode9 在 71 倍 / mode3 基础上微调评分，**信号条件与 mode3 完全一致**（`_mode9_signals` 复用 `_mode3_signals`），仅评分函数改为 `_score_mode9`，用于选股更准、替代原 71 倍作为默认模型。

代码位置：`app/scanner.py`（`_score_mode9`、`_mode9_signals`）。

---

## 一、与 mode3 相同的部分

- **信号条件**：60 根 K 线起算，MA10>MA20>MA60 且三线向上、收盘≥MA20、放量≥1.2 倍、20 日涨幅≤25%。与 [71倍模型公式.md](71倍模型公式.md) 一致。
- **买入/回测**：T+1 开盘买，破 MA10 或 10% 止损或期末平仓。

---

## 二、mode9 评分在 mode3 基础上的加减项

在 `_score_mode3` 基础分上，仅用当日及历史数据：

| 类型 | 规则 | 分值 |
|------|------|------|
| 收盘距 MA20 过远 | close 相对 MA20 > 8% | -2 |
| MA5 斜率过陡 | 5 日内 MA5 涨幅 > 15% | -2 |
| MA20–MA60 开口大 | (MA20-MA60)/MA60 ≥ 3% | +2 |
| 当日实体占比大 | 实体/振幅 ≥ 60% | +2 |
| 60 日涨幅适中 | ret60 在 15%～40% | +1 |
| 量能放大太快 | 近 3 日均量/再前 3 日 > 2，或 当日量/5 日前量 > 2.8 | -2（各自最多 -2） |
| **均线整齐度** | 当日 MA5>MA10>MA20 | +2 |
| **均线交叉多** | 近 5 日内 MA5–MA10 或 MA10–MA20 交叉次数 ≥ 2 | -2 |
| **MA5–MA10 粘连** | 当日或近 5 日内 \|MA5-MA10\|/MA10 < 1% | -2 |
| **MA5 拐头向下再拐回** | 昨日或前日 MA5 曾向下，当日 MA5 向上 | -2 |
| **当日量/前一日量** | 比例 > 2 时按比例扣分：min(10, max(2, (ratio-2)×4)) | -2～-10 |

最终 `score = int(max(0, min(100, base)))`。

---

## 三、使用方式

- **网页/扫描**：模型下拉选「mode9（当前主模型，原71倍升级）」或默认即为 mode9。
- **个股评分**：`/score` 页与 `app/stock_score.score_stock()` 默认使用 mode9。
- **回测脚本**：使用 `scan_with_mode3(..., use_mode9=True)` 或各脚本中的 mode9 选项。
